<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cabinet Designer Mobile v3 - Instagram Style</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
        }
        
        .test-container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.1);
        }
        
        .demo-title {
            font-size: 24px;
            font-weight: 700;
            color: #000;
            margin-bottom: 8px;
        }
        
        .demo-subtitle {
            font-size: 16px;
            color: #8e8e93;
            margin-bottom: 16px;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(45deg, #007aff, #34aadc);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .test-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #000;
        }
        
        .test-btn {
            background: #007aff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 20px;
            margin: 8px 8px 8px 0;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }
        
        .test-btn:active {
            background: #0056b3;
            transform: scale(0.95);
        }
        
        .test-btn.secondary {
            background: #f8f9fa;
            color: #007aff;
            border: 1px solid rgba(0, 122, 255, 0.2);
        }
        
        .test-btn.secondary:active {
            background: #e9ecef;
        }
        
        .mock-canvas {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }
        
        .mock-canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
        }
        
        .status {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            font-size: 14px;
            border-left: 4px solid #007aff;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .feature-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .feature-title {
            font-size: 14px;
            font-weight: 600;
            color: #000;
            margin-bottom: 4px;
        }
        
        .feature-desc {
            font-size: 12px;
            color: #8e8e93;
        }
        
        .swipe-demo {
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }
        
        .swipe-demo::after {
            content: '‚Üê –°–≤–∞–π–ø ‚Üí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            font-weight: 700;
            opacity: 0.7;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .instagram-hint {
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="demo-header">
            <div class="demo-title">Cabinet Designer Mobile</div>
            <div class="demo-subtitle">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–∏–ª–µ Instagram</div>
            <div class="version-badge">v3.0 Instagram Style</div>
        </div>
        
        <div class="instagram-hint">
            üì± –¢–µ–ø–µ—Ä—å —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∫–∞–∫ –≤ Instagram! –í—ã–¥–≤–∏–∂–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–Ω–∏–∑—É –∏ —Å–≤–∞–π–ø-–∂–µ—Å—Ç—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–æ–≤.
        </div>
        
        <div class="test-section">
            <div class="section-title">üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
            <button class="test-btn" onclick="initMobile()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å UI</button>
            <button class="test-btn secondary" onclick="destroyMobile()">–°–∫—Ä—ã—Ç—å UI</button>
            <div id="mobileStatus" class="status">–ì–æ—Ç–æ–≤ –∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...</div>
        </div>
        
        <div class="test-section">
            <div class="section-title">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π</div>
            <button class="test-btn" onclick="testToast()">Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
            <button class="test-btn" onclick="testDimensions()">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã</button>
            <button class="test-btn" onclick="testAddElement()">–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</button>
            <button class="test-btn" onclick="testViewSwitch()">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥</button>
        </div>
        
        <div class="test-section">
            <div class="section-title">üì± –î–µ–º–æ –æ–±–ª–∞—Å—Ç—å —Å –∂–µ—Å—Ç–∞–º–∏</div>
            <div id="mockCanvas" class="mock-canvas">
                <span style="position: relative; z-index: 1;">–¢–µ—Å—Ç–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è —Å–≤–∞–π–ø–æ–≤</span>
            </div>
            <div class="swipe-demo" id="swipeDemo">
                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–≤–∞–π–ø –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è 2D/3D
            </div>
            <div id="gestureInfo" class="status">–ñ–µ—Å—Ç—ã: –æ–∂–∏–¥–∞–Ω–∏–µ</div>
        </div>
        
        <div class="test-section">
            <div class="section-title">‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üè†</div>
                    <div class="feature-title">5 –≤–∫–ª–∞–¥–æ–∫</div>
                    <div class="feature-desc">–ö–∞–∫ –≤ Instagram</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚¨ÜÔ∏è</div>
                    <div class="feature-title">–í—ã–¥–≤–∏–∂–Ω–∞—è –ø–∞–Ω–µ–ª—å</div>
                    <div class="feature-desc">–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üëÜ</div>
                    <div class="feature-title">–°–≤–∞–π–ø –∂–µ—Å—Ç—ã</div>
                    <div class="feature-desc">2D ‚Üî 3D —Ä–µ–∂–∏–º</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üé®</div>
                    <div class="feature-title">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω</div>
                    <div class="feature-desc">Blur —ç—Ñ—Ñ–µ–∫—Ç—ã</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="section-title">üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</div>
            <div id="deviceInfo" class="status"></div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <script src="js/mobile/mobileUIManager.js"></script>
    <script src="js/mobile/touchHandler.js"></script>
    
    <script>
        let mobileUI = null;
        let swipeStartX = 0;

        // –ú–æ–∫ –æ–±—ä–µ–∫—Ç app –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.app = {
            cabinet: {
                parts: [
                    {type: 'shelf'}, {type: 'shelf'}, {type: 'shelf'},
                    {type: 'stand'}, {type: 'stand'},
                    {type: 'rod'}
                ],
                getState: () => ({mock: true}),
                setState: () => {}
            },
            mode: 'none',
            scale: 1,
            targetScale: 1,
            offsetX: 0,
            offsetY: 0
        };

        // –ú–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏
        window.setMode = (mode) => {
            window.app.mode = mode;
            updateStatus(`–†–µ–∂–∏–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${mode}`);
        };

        window.applyDimensions = () => {
            updateStatus('–†–∞–∑–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
        };

        window.render = () => {
            updateStatus('–†–µ–Ω–¥–µ—Ä –≤—ã–∑–≤–∞–Ω');
        };

        window.historyManager = {
            canUndo: () => true,
            canRedo: () => false,
            undo: () => ({mock: true}),
            redo: () => ({mock: true})
        };

        // –ú–æ–∫ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        document.addEventListener('DOMContentLoaded', function() {
            // –°–æ–∑–¥–∞–µ–º –º–æ–∫ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const mockElements = {
                'view2d': {classList: {contains: () => true, add: () => {}, remove: () => {}}, click: () => updateStatus('2D –≤–∏–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω')},
                'view3d': {classList: {contains: () => false, add: () => {}, remove: () => {}}, click: () => updateStatus('3D –≤–∏–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω')},
                'width': {value: '800'},
                'height': {value: '1800'},
                'depth': {value: '500'},
                'undo': {disabled: false, click: () => updateStatus('–û—Ç–º–µ–Ω–∞')},
                'redo': {disabled: true, click: () => updateStatus('–ü–æ–≤—Ç–æ—Ä')},
                'reset': {click: () => updateStatus('–°–±—Ä–æ—Å')},
                'toggleDimensions': {click: () => updateStatus('–†–∞–∑–º–µ—Ä—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã')},
                'canvas': document.getElementById('mockCanvas')
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–∫ getElementById
            const originalGetElementById = document.getElementById;
            document.getElementById = function(id) {
                return mockElements[id] || originalGetElementById.call(document, id);
            };
        });

        function updateStatus(message) {
            const status = document.getElementById('mobileStatus');
            if (status) {
                status.innerHTML = `
                    <strong>${new Date().toLocaleTimeString()}</strong><br>
                    ${message}
                `;
            }
        }

        function initMobile() {
            try {
                if (mobileUI) {
                    mobileUI.destroy();
                }
                
                mobileUI = new MobileUIManager();
                updateStatus('‚úÖ Instagram-style –º–æ–±–∏–ª—å–Ω—ã–π UI –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞.');
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–µ–º–æ —Å–≤–∞–π–ø—ã
                setupDemoSwipes();
                
            } catch (error) {
                updateStatus('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function destroyMobile() {
            if (mobileUI) {
                mobileUI.destroy();
                mobileUI = null;
                updateStatus('UI —Å–∫—Ä—ã—Ç');
            }
        }

        function testToast() {
            if (mobileUI) {
                mobileUI.showToast('üéâ Instagram-style Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!');
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π UI');
            }
        }

        function testDimensions() {
            if (mobileUI) {
                // –≠–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫ –ø–æ –≤–∫–ª–∞–¥–∫–µ —Ä–∞–∑–º–µ—Ä–æ–≤
                const dimensionsTab = document.querySelector('.nav-tab[data-tab="dimensions"]');
                if (dimensionsTab) {
                    dimensionsTab.click();
                    updateStatus('–ü–∞–Ω–µ–ª—å —Ä–∞–∑–º–µ—Ä–æ–≤ –æ—Ç–∫—Ä—ã—Ç–∞');
                } else {
                    mobileUI.showToast('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "–†–∞–∑–º–µ—Ä—ã"');
                }
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π UI');
            }
        }

        function testAddElement() {
            if (mobileUI) {
                mobileUI.addElement('shelf');
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π UI');
            }
        }

        function testViewSwitch() {
            if (mobileUI) {
                if (mobileUI.currentView === '2d') {
                    mobileUI.switchTo3D();
                } else {
                    mobileUI.switchTo2D();
                }
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π UI');
            }
        }

        function setupDemoSwipes() {
            const swipeDemo = document.getElementById('swipeDemo');
            const gestureInfo = document.getElementById('gestureInfo');
            
            if (!swipeDemo) return;
            
            swipeDemo.addEventListener('touchstart', (e) => {
                swipeStartX = e.touches[0].clientX;
                gestureInfo.textContent = '–ö–∞—Å–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ...';
            });
            
            swipeDemo.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[0].clientX;
                const deltaX = endX - swipeStartX;
                
                if (Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        gestureInfo.textContent = '‚úÖ –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ! (‚Üí 3D —Ä–µ–∂–∏–º)';
                        if (mobileUI) mobileUI.switchTo3D();
                    } else {
                        gestureInfo.textContent = '‚úÖ –°–≤–∞–π–ø –≤–ª–µ–≤–æ! (‚Üê 2D —Ä–µ–∂–∏–º)';
                        if (mobileUI) mobileUI.switchTo2D();
                    }
                } else {
                    gestureInfo.textContent = '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Å–≤–∞–π–ø. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                }
            });
        }

        function updateDeviceInfo() {
            const info = document.getElementById('deviceInfo');
            if (info) {
                const isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;
                info.innerHTML = `
                    <strong>–≠–∫—Ä–∞–Ω:</strong> ${window.innerWidth} √ó ${window.innerHeight}px<br>
                    <strong>–ö–∞—Å–∞–Ω–∏—è:</strong> ${'ontouchstart' in window ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è ‚úÖ' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è ‚ùå'}<br>
                    <strong>–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> ${isMobile ? '–î–∞ ‚úÖ' : '–ù–µ—Ç (—ç–º—É–ª—è—Ü–∏—è) üì±'}<br>
                    <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${navigator.userAgent.split(' ')[0]}
                `;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            updateDeviceInfo();
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Instagram-style –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            if (window.innerWidth <= 768) {
                setTimeout(initMobile, 500);
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
        window.addEventListener('resize', updateDeviceInfo);
    </script>
</body>
</html>
